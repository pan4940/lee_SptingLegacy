<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="product.mapper.ProductMapper">
	 
    <select id="getProductCategoryList" resultType="ProductCategoryDTO">
		<![CDATA[
		select 
			level, PRODUCT_CATEGORY_NUM, PRODUCT_CATEGORY_NAME, PRODUCT_CATEGORY_NUM_REF 
		from 
			product_category
		where 
			product_category_num < 10000	
    	start with PRODUCT_CATEGORY_NUM_REF is null connect by prior PRODUCT_CATEGORY_NUM = PRODUCT_CATEGORY_NUM_REF
    	]]>
    </select>
    
	<select id="getBrandsCategoryList" resultType="ProductCategoryDTO">
		<![CDATA[
		select 
			level, PRODUCT_CATEGORY_NUM, PRODUCT_CATEGORY_NAME, PRODUCT_CATEGORY_NUM_REF, PRODUCT_CATEGORY_DESCRIP 
		from 
			product_category
		where 
			product_category_num > 10000	
    	start with PRODUCT_CATEGORY_NUM_REF is null connect by prior PRODUCT_CATEGORY_NUM = PRODUCT_CATEGORY_NUM_REF
    	]]>
    </select>
    
    <insert id="createBrandCategorySelectKey" parameterType="ProductCategoryDTO">
    	<selectKey keyProperty="product_category_num" order="BEFORE" resultType="int">
			select SEQ_PRODUCT_CATEGORY_NUM.nextval from dual
		</selectKey>
    	
    	insert into PRODUCT_CATEGORY (
    		product_category_num, 
    		product_category_name, 
    		product_category_num_ref, 
    		product_category_descrip
    	) values (
    		#{product_category_num},
    		#{product_category_name},
    		#{product_category_num_ref},
    		#{product_category_descrip}
    	)
    </insert>
	
	
	
	<insert id="productRegister" parameterType="ProductDTO">
		insert into PRODUCT (
    		PRODUCT_num,
    		PRODUCT_NAME,
    		PRODUCT_PRICE,
    		CATECODE1,
    		CATECODE2,
    		CATECODE3, 
    		BRAND_NAME,
    		BRANDCATEGORY,
    		PRODUCT_DESCRIP
    	) values (
    		seq_PRODUCT_ID.nextval,
    		#{product_name},
    		#{product_price},
    		#{cateCode1},
    		#{cateCode2},
    		#{cateCode3},
    		#{brand_name},
    		#{brandCategory},
    		#{product_descrip}
    	)
	</insert>
	
	<insert id="productRegisterSelectKey" parameterType="ProductDTO">
		<selectKey keyProperty="product_num" order="BEFORE" resultType="int">
			select SEQ_PRODUCT_ID.nextval from dual
		</selectKey>
		insert into PRODUCT (
    		PRODUCT_num,
    		PRODUCT_NAME,
    		PRODUCT_PRICE,
    		BRAND_NAME,
    		PRODUCT_DESCRIP,
    		CATECODE1,
    		CATECODE2,
    		CATECODE3,
    		BRANDCATEGORY
    	) values (
    		#{product_num},
    		#{product_name},
    		#{product_price},
    		#{brand_name},
    		#{product_descrip},
    		#{cateCode1},
    		#{cateCode2},
    		#{cateCode3},
    		#{brandCategory}
    	)
	</insert>
	
	<insert id="productRegisterCategory_link" parameterType="ProductDTO">
		begin
			insert into product_category_link(
			    PRODUCT_NUM,
			    PRODUCT_CATEGORY_NUM
			) values (
			    #{product_num},
			    #{cateCode1}
			);
			
			insert into product_category_link(
			    PRODUCT_NUM,
			    PRODUCT_CATEGORY_NUM
			) values (
			    #{product_num},
			    #{cateCode2}
			);
			
			<if test="cateCode3 != 0">
				insert into product_category_link(
				    PRODUCT_NUM,
				    PRODUCT_CATEGORY_NUM
				) values (
				    #{product_num},
				    #{cateCode3}
				);
			</if>
			
			
			insert into product_category_link(
			    PRODUCT_NUM,
			    PRODUCT_CATEGORY_NUM
			) values (
			    #{product_num},
			    #{brandCategory}
			);
		end;	
	</insert>
		
	
	<select id="getProduct" parameterType="int" resultType="ProductDTO">
		select * from product where product_num = #{product_num}
	</select>
	
	<select id="searchProductName" parameterType="String" resultType="ProductDTO">
		<![CDATA[
		select * from product where LOWER(product_name) like '%' || #{product_name} || '%'
		]]>
	</select>
	
	<select id="findBrandNameByBrandCategory" parameterType="int" resultType="String">
		select product_category_name from product_category where product_category_num = #{brandCategory}
	</select>
	
	<select id="getProductByCategory" parameterType="java.util.Map" resultType="ProductDTO">
		select * from product where cateCode1 = #{cateCode1} 
		<if test="cateCode2 != 0">
			and cateCode2 = #{cateCode2}
		</if> 
		<if test="cateCode3 != 0">
			and cateCode3 = #{cateCode3}
		</if>
		<if test="brandCategory != 0">
			and brandCategory = #{brandCategory}
		</if>
	</select>
	
	<select id="getProductCategoryDTO" parameterType="int" resultType="ProductCategoryDTO">
		select * from product_category where product_category_num = #{product_category_num}
	</select>
	
	<select id="getProductByProductNum" parameterType="String" resultType="ProductDTO">
		select * from product where product_num = #{product_num}
	</select>
	
	
	<select id="getProductsByBrandCategory" parameterType="int" resultType="ProductDTO">
		select * from product where BRANDCATEGORY = #{brandCategory}
	</select>
	
	<select id="getBrandnameByBrandcategory" parameterType="int" resultType="String">
		select PRODUCT_CATEGORY_NAME from PRODUCT_CATEGORY where PRODUCT_CATEGORY_NUM = #{brandCategory}
	</select>
	
	<update id="modifyProduct" parameterType="ProductDTO">
		update product set 
		<if test="cateCode1 != 0">
			cateCode1 = #{cateCode1},
		</if>
		<if test="cateCode2 != 0">
			cateCode2 = #{cateCode2},
		</if>
		<if test="cateCode3 != 0">
			cateCode3 = #{cateCode3},
		</if>
		<if test="brandCategory != 0">
			brandCategory = #{brandCategory},
		</if>
			product_name = #{product_name}, 
			product_price = #{product_price}, 
			product_descrip = #{product_descrip}, 
			updatedate = sysdate 
		where product_num = #{product_num}
	
	</update>
	
	<update id="modifyBrandCategory" parameterType="ProductCategoryDTO">
		update PRODUCT_CATEGORY set
    		product_category_name = #{product_category_name}, 
    		product_category_descrip = #{product_category_descrip}
    	where product_category_num = #{product_category_num}
	</update>
	
	
	<delete id="productDeleteCategory_link" parameterType="int"> 
		delete PRODUCT_CATEGORY_LINK where product_num = #{product_num}
	</delete>
	
	<delete id="deleteProduct" parameterType="int">
		delete product where product_num = #{product_num}
	</delete>
</mapper>